<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Preupdate Handler Plugin</title>
    <link rel="StyleSheet" href="css/plugins-other.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>BillingCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="p-plugins.html#2408960">Plugins</a> : <a class="WebWorks_Breadcrumb_Link" href="plugins-other.19.1.html#2408960">Other Plugin Interfaces</a> : Preupdate Handler Plugin</span></div>
    <hr align="left" />
    <blockquote>
      <h3 class="H1_-_Heading_1"><a name="2408960">Preupdate Handler Plugin</a></h3>
      <div class="B_-_Body"><a name="2576955">In some cases it makes sense to implement preupdate handling in plugin code rather than in a rule set. To implement preupdate handling in plugin code, register an implementation of the </a><span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin interface.</div>
      <div class="B_-_Body"><a name="2577477">It is best to use </a><span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin instead of Preupdate Rules in the following cases:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="2577478">If you need to create entity instances</a></span> – If you have tasks that must create new entity instances, the plugin approach is best. The application calls the <span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin before calling the rule set. The Preupdate rules run on all new entities created by the <span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin implementation. You can separate your code into tasks that create objects in the plugin, and other tasks in the rule set. Without using the plugin, a Preupdate rule that creates a new entity must incorporate the logic in Preupdate rules that explicitly check the new entity instances also.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="2577479">If you need to handle removed or deleted entity instances</a></span> – Similarly, this plugin is good for tasks that must deal with removed objects, which are entity instances that BillingCenter will delete or retire on commit. A Preupdate rule set for a particular entity type does not run simply for removal of the deleted object. Only add or change of an entity instance triggers Preupdate and Validation rule sets for that entity type. However, the <span class="cv_-_computer_voice">IPreUpdateHandler</span> has direct access to removed entity instances in the bundle. Therefore, it is best that work that involves removed objects, and optionally new and changed objects, happen in the <span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin implementation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="2577823">If you need to process entity instances within the bundle in a particular order</a></span> – Use the plugin to process entity instances in the bundle in any order. For example, sort entity instances by entity type or other sorting criteria.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2577669">Registering and enabling this plugin is sufficient for BillingCenter to call the plugin for preupdate, independent of the server </a><span class="cv_-_computer_voice">config.xml</span> parameter <span class="cv_-_computer_voice">UseOldStylePreUpdate</span>.</div>
      <div class="B_-_Body"><a name="2577494">Next, if the server </a><span class="cv_-_computer_voice">config.xml</span> parameter <span class="cv_-_computer_voice">UseOldStylePreUpdate</span> is set to <span class="cv_-_computer_voice">true</span>, BillingCenter additionally calls the validation-graph based Preupdate rule set after calling the plugin. </div>
      <div class="B_-_Body"><a name="2401211">Your plugin implementation must implement one method, </a><span class="cv_-_computer_voice">executePreUpdate</span>. This method takes a single preupdate context object, <span class="cv_-_computer_voice">PreUpdateContext</span>, and returns nothing. </div>
      <div class="B_-_Body"><a name="2401213">The </a><span class="cv_-_computer_voice">PreUpdateContext</span> object has several properties you can get, which return a list (<span class="cv_-_computer_voice">java.util.List</span>) of entities in the current database transaction. </div>
      <div class="B_-_Body"><a name="2401214">From Gosu they look like the following properties:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2401215">InsertedBeans</a></span> – An unordered list of entities added in this transaction. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2401216">UpdatedBeans</a></span> – An unordered list of entities changed in this transaction. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2401217">RemovedBeans</a></span> – An unordered list of entities added in this transaction. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2545362">From Java, these properties appear as three methods: </a><span class="cv_-_computer_voice">getInsertedBeans</span>, <span class="cv_-_computer_voice">getUpdatedBeans</span>, and <span class="cv_-_computer_voice">getRemovedBeans</span>.</div>
      <div class="B_-_Body"><a name="2577005">For an overview of preupdate rules, see </a><a href="javascript:WWHClickedPopup('rules', 'bc_rulesets.09.7.html#16442427', '');" title="Preupdate">“Preupdate” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('rules', 'bc_rulesets.09.7.html#16442427', '');" title="Preupdate">Rules Guide</a></span></div>
      <h6 class="HS_-_Head_Sub"><a name="2545370">Default Plugin Implementation</a></h6>
      <div class="B_-_Body"><a name="2545375">In the base configuration, BillingCenter provides the plugin implementation </a><span class="cv_-_computer_voice">gw.plugin.preupdate.impl.PreUpdateHandlerImpl</span>. </div>
      <div class="B_-_Body"><a name="2401236">By default, this plugin implementation class collects all inserted and updated beans</a>, as well as accounts and jobs if any assignments changed. </div>
      <div class="B_-_Body"><a name="2408862">Any exception cause the bounding database transaction to roll back, effectively undoing the update.</a></div>
      <h6 class="HS_-_Head_Sub" style="color: #000000; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span class="cvh_-_computer_voice_in_heading" style="font-family: Calibri; font-weight: bold"><a name="2577012">PreUpdateUtil</a></span></h6>
      <div class="B_-_Body"><a name="2577013">It is possible to maintain some preupdate code in this plugin but still call preupdate rules in some cases. BillingCenter includes the </a><span class="cv_-_computer_voice">PreUpdateUtil</span> class in the <span class="cv_-_computer_voice">gw.api.preupdate</span> package to let you call preupdate rules from your plugin. The <span class="cv_-_computer_voice">PreUpdateUtil</span> class provides a single method, <span class="cv_-_computer_voice">executePreUpdateRules</span>. That method executes preupdate rules on an entity if it has an associated preupdate rule set. It does nothing if a preupdate rule does not exist. </div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>