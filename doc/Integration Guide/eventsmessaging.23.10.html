<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Implementing Messaging Plugins</title>
    <link rel="StyleSheet" href="css/eventsmessaging.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>BillingCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="p-messaging.html#3807598">Messaging</a> : <a class="WebWorks_Breadcrumb_Link" href="eventsmessaging.23.01.html#3807598">Messaging and Events</a> : Implementing Messaging Plugins</span></div>
    <hr align="left" />
    <blockquote>
      <h3 class="H1_-_Heading_1"><a name="3807598">Implementing Messaging Plugins</a></h3>
      <div class="B_-_Body"><a name="3110418">There are three types of messaging plugins. See the following sections for details:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#3110432', '');" title="Implementing Messaging Plugins" name="3110422">“Implementing a Message Request Plugin”</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#3715746', '');" title="Implementing Messaging Plugins" name="3110426">“Implementing a Message Transport Plugin”</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#3110489', '');" title="Implementing Messaging Plugins" name="3110430">“Implementing a Message Reply Plugin”</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="4248407">Event Fired rules and messaging plugin implementations have limitations about what data you can change. See </a><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.02.html#4367010', '');" title="Messaging Overview">“Restrictions on Entity Data in Messaging Rules and Messaging Plugins”</a>.</div>
      <h4 class="H2_-_Heading_2"><a name="3715751">Getting Message Transport Parameters from the Plugin Registry</a></h4>
      <div class="B_-_Body"><a name="4197298">It may be useful in some cases to get parameters from the plugin registry in Studio. The benefit of setting parameters for messaging transports is that you can separate out variable or environment-specific data from your code in your plugin.</a></div>
      <div class="B_-_Body"><a name="4197156">For example, you could use the Plugins editor in Studio for each messaging plugin to specify the following types of data for the transport:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="4197168">external system’s server name</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="4197197">external system’s port number</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="4197205">a timeout value</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="4197115">If you want to get parameters from the plugin registry, your messaging plugin must explicitly implement </a><span class="cv_-_computer_voice">InitializablePlugin</span> in the class definition. This interface tells the application that you support the <span class="cv_-_computer_voice">setParameters</span> method to get parameters from the plugin registry. Your code gets the parameters as name/value pairs of <span class="cv_-_computer_voice">String</span> values in a <span class="cv_-_computer_voice">java.util.Map</span> object.</div>
      <div class="B_-_Body"><a name="4197084">For example, suppose your plugin implementation’s first line looks like this:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715752">class MyTransport implements MessageTransport {</a></PRE>
      <div class="B_-_Body"><a name="3715753">Change it to this:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715755">class MyTransport implements MessageTransport, InitializablePlugin {</a></PRE>
      <div class="B_-_Body"><a name="3715756">To conform to this new interface, add a </a><span class="cv_-_computer_voice">setParameters</span> method with the following signature:</div>
      <PRE class="CF_-_Code_First_Line"><a name="3715757">function setParameters(map: java.util.Map)  { // this is part of InitializablePlugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715758">&nbsp;&nbsp;&nbsp;&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715759">&nbsp;&nbsp;&nbsp;&nbsp;// access values in the MAP to get parameters defined in plugin registry in Studio</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715760">&nbsp;&nbsp;&nbsp;&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3760921">&nbsp;&nbsp;&nbsp;var myValueFromTheMap = map["servername"]</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="3715761">}</a></PRE>
      <h4 class="H2_-_Heading_2"><a name="3110432">Implementing a Message Request Plugin</a></h4>
      <div class="B_-_Body"><a name="3110435">A destination can optionally define a message request (</a><span class="cv_-_computer_voice">MessageRequest</span>) plugin to prepare a <span class="cv_-_computer_voice">Message</span> object before a message is sent to the message transport. It may not be necessary to do this step. For example, if textual message payload contains strings or codes that must be translated for a specific remote system. Or perhaps a textual message payload contains simple name/value pairs that must be translated into a XML before sending to the message transport. Or, perhaps you need to set data model extension properties on <span class="cv_-_computer_voice">Message</span>.</div>
      <div class="B_-_Body"><a name="3110438">To prepare a message before sending, implement the </a><span class="cv_-_computer_voice">MessageRequest</span> method <span class="cv_-_computer_voice">beforeSend</span>. BillingCenter calls this method with the message entity (a <span class="cv_-_computer_voice">Message</span>). </div>
      <div class="B_-_Body"><a name="3758552">The main task for this method is to generate a modified payload and return it from the method. Generally speaking, do not modify the payload directly in the </a><span class="cv_-_computer_voice">Message</span> entity. The result from this method passes to the messaging transport plugin to send in its <span class="cv_-_computer_voice">transformedPayload</span> parameter. This transformed payload parameter is separate from the <span class="cv_-_computer_voice">Message</span> entity that the message transport plugin gets as a parameter.</div>
      <div class="B_-_Body"><a name="3758551">You can modify properties within the </a><span class="cv_-_computer_voice">Message</span> or within the message’s root object such as a <span class="cv_-_computer_voice">Account</span> object as needed. However, as mentioned before, to transform the payload just return a String value from the method rather than modifying the <span class="cv_-_computer_voice">Message</span>.</div>
      <div class="B_-_Body"><a name="3110446">You can also use the </a><span class="cv_-_computer_voice">MessageRequest</span> plugin to perform post-sending processing on the message. To perform this type of action, implement the <span class="cv_-_computer_voice">MessageRequest</span> method <span class="cv_-_computer_voice">afterSend</span>. BillingCenter calls the method with the message (a <span class="cv_-_computer_voice">Message</span> object) as a parameter. BillingCenter calls this method <span class="e_-_emphasis">immediately</span> after the transport plugin’s <span class="cv_-_computer_voice">send</span> method completes. If you implement asynchronous callbacks with a message reply plugin, be sure to understand that the server calls <span class="cv_-_computer_voice">afterSend</span> in the same thread executing the plugin’s <span class="cv_-_computer_voice">send</span> method. However, it might be a separate thread from any asynchronous callback code.</div>
      <div class="B_-_Body"><a name="4125080">Also, if the </a><span class="cv_-_computer_voice">send</span> method acknowledges the message with any result (successful ACK or an error), then be aware that the ACK does not affect whether the application calls <span class="cv_-_computer_voice">afterSend</span>. Assuming no exceptions trigger during calls to <span class="cv_-_computer_voice">beforeSend</span> or <span class="cv_-_computer_voice">send</span>, BillingCenter calls the <span class="cv_-_computer_voice">afterSend</span> method.</div>
      <div class="B_-_Body"><a name="4197422">If you want to get parameters from the plugin registry, your messaging plugin must explicitly implement </a><span class="cv_-_computer_voice">InitializablePlugin</span> in the class definition. This interface tells the application that you support the <span class="cv_-_computer_voice">setParameters</span> method to get parameters from the plugin registry. Your code gets the parameters as name/value pairs of <span class="cv_-_computer_voice">String</span> values in a <span class="cv_-_computer_voice">java.util.Map</span> object.</div>
      <h4 class="H2_-_Heading_2"><a name="3715746">Implementing a Message Transport Plugin</a></h4>
      <div class="B_-_Body"><a name="3110464">A destination must define a message transport (</a><span class="cv_-_computer_voice">MessageTransport</span>) plugin to send a <span class="cv_-_computer_voice">Message</span> object over some physical or abstract transport. This might involve submitting a message to a message queue, calling a remote web service API, or might implement a complex proprietary protocol specific to some remote system. The message transport plugin is the only required plugin interface for a destination.</div>
      <div class="B_-_Body"><a name="3110467">To send a message, implement the </a><span class="cv_-_computer_voice">send</span> method, which BillingCenter calls with the message (a <span class="cv_-_computer_voice">Message</span> object). That method has another argument, which is the <span class="e_-_emphasis">transformed payload</span> if that destination implemented a message request plugin. See <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#3110432', '');" title="Implementing Messaging Plugins">“Implementing a Message Request Plugin”</a>.</div>
      <div class="B_-_Body"><a name="3115403">In the message transport plugin’s simplest form, this method does its work synchronously entirely in the </a><span class="cv_-_computer_voice">send</span> method. For example, call a single remote API call such as an outgoing web service request on a legacy computer. Your <span class="cv_-_computer_voice">send</span> method optionally can immediately acknowledge the message with the code <span class="cv_-_computer_voice">message.reportAck(...)</span>. If there are errors, instead use the message method <span class="cv_-_computer_voice">reportError</span>. To report a duplicate message, use <span class="cv_-_computer_voice">reportDuplicate</span>, which is a method not on the current message but on the <span class="cv_-_computer_voice">MessageHistory</span> entity that represents the original message.</div>
      <div class="B_-_Body"><a name="3110476">If you must acknowledge the message synchronously, your </a><span class="cv_-_computer_voice">send</span> method may optionally update properties on BillingCenter objects such as <span class="cv_-_computer_voice">Account</span>. If you desire this, you can get the message root object by getting the property <span class="ps_-_parameter_in_code_snippets">theMessage</span><span class="cv_-_computer_voice">.MessageRoot</span>. Changes to the message and any other modified entities persist to the database after the <span class="cv_-_computer_voice">send</span> method completes. Changes also persist after the <span class="cv_-_computer_voice">MessageRequest</span> plugin completes work in its <span class="cv_-_computer_voice">afterSend</span> method. To visualize how these elements interact, see the diagram in <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.03.html#3006454', '');" title="Message Destination Overview">“Message Destination Overview”</a>.</div>
      <div class="B_-_Body"><a name="3115429">If your message transport plugin </a><span class="cv_-_computer_voice">send</span> method does not synchronously acknowledge the message before returning, then this destination must also implement the message reply plugin. The message reply plugin to handle the asynchronous reply. See the <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#3110489', '');" title="Implementing Messaging Plugins">“Implementing a Message Reply Plugin”</a> for details.</div>
      <div class="B_-_Body"><a name="3110480">You must handle the possibility of receiving duplicate message notifications from your external systems. Usually, the receiving system detects duplicate messages by tracking the message ID, and returns an appropriate status message. The plugin code that receives the reply messages can call the </a><span class="ps_-_parameter_in_code_snippets">message</span><span class="cv_-_computer_voice">.reportDuplicate()</span> method. Depending on the implementation, the code that receives the reply would be either the message transport plugin or the message reply plugin. Your code that detects the duplicate must skip further processing or acknowledgement for that message.</div>
      <div class="B_-_Body"><a name="3758637">Your implementations of messaging plugins must explicitly implement </a><span class="cv_-_computer_voice">InitializablePlugin</span> in the class definition. This interface tells BillingCenter that you support the <span class="cv_-_computer_voice">setParameters</span> method to get parameters from the plugin registry. Even if you do not need parameters, your plugin implementation must implement <span class="cv_-_computer_voice">InitializablePlugin</span> or the application does not initialize your messaging plugin.</div>
      <div class="B_-_Body"><a name="3715799">Your implementation of this plugin must explicitly implement </a><span class="cv_-_computer_voice">InitializablePlugin</span> in the class definition and then also add a <span class="cv_-_computer_voice">setParameters</span> method to get parameters. Implement this interface even if you do not need the parameters from the plugin registry.</div>
      <div class="B_-_Body"><a name="3752002">The following example in Java demonstrates a basic message transport.</a></div>
      <h6 class="HS_-_Head_Sub"><a name="3115384">Example Basic Message Transport For Testing</a></h6>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715648">uses java.util.Map;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715649">uses java.plugin;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715650">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715652">class MyTransport implements MessageTransport, InitializablePlugin {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715653">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715661">function setParameters(map: java.util.Map)  { // this is part of InitializablePlugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715662">&nbsp;&nbsp;&nbsp;&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715663">&nbsp;&nbsp;&nbsp;&nbsp;// access values in the MAP to get parameters defined in plugin registry in Studio</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715664">&nbsp;&nbsp;&nbsp;&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715665">   }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715666">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715667">&nbsp;&nbsp;// NEXT, define all your other methods required by the MAIN interface you are implementing...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715668">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715669">   function suspend() {}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715670">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715671">   function shutdown() {}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715672">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715673">   function setDestinationID(id:int) {}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715674">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715675">   function resume() {}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715676">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715677">   function send(message:entity.Message, transformedPayload:String) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715678">     print("======================================================")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715679">     print(message)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715680">     message.reportAck()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715681">   }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715682">}</a></PRE>
      <h6 class="HS_-_Head_Sub"><a name="3715646">More Examples</a></h6>
      <div class="B_-_Body"><a name="3715642">Several example message transport plugins ship with BillingCenter in the product in the following directory: </a></div>
      <div class="CS_-_Code_Single_Line"><a name="4125198">BillingCenter/java-api/examples/src/examples/pl/plugins/messaging</a></div>
      <h6 class="HS_-_Head_Sub"><a name="3110483">Exception Handling</a></h6>
      <div class="B_-_Body"><a name="3110486">For details of exceptions and handling suspect/shutdown in messaging plugins, see </a><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#4431574', '');" title="Implementing Messaging Plugins">“Error Handling in Messaging Plugins”</a>.</div>
      <h4 class="H2_-_Heading_2"><a name="3110489">Implementing a Message Reply Plugin</a></h4>
      <div class="B_-_Body"><a name="4430694">A destination can optionally define a message reply (</a><span class="cv_-_computer_voice">MessageReply</span>) plugin to asynchronously acknowledge a <span class="cv_-_computer_voice">Message</span>. For instance, this plugin might implement a trigger from an external system that notifies BillingCenter that the message send succeeded or failed.</div>
      <div class="B_-_Body"><a name="4430799">BillingCenter requires a special step in this process to setup the BillingCenter database transaction information appropriately so that any entity changes commit to the BillingCenter database. To do this properly, Guidewire provides the types </a><span class="cv_-_computer_voice">MessageFinder</span>, <span class="cv_-_computer_voice">PluginCallbackHandler</span>, and inner interface <span class="cv_-_computer_voice">PluginCallbackHandler.Block</span>.</div>
      <div class="B_-_Body"><a name="4430782">A message finder </a><span class="cv_-_computer_voice">(MessageFinder)</span> object is built-in object that returns a <span class="cv_-_computer_voice">Message</span> entity instance from its <span class="cv_-_computer_voice">messageID</span> or <span class="cv_-_computer_voice">senderRefID</span>, using its <span class="cv_-_computer_voice">findById</span> or <span class="cv_-_computer_voice">findBySendRefId</span> method. During the message reply plugin initialization phase, BillingCenter calls the message reply plugin <span class="cv_-_computer_voice">initTools</span> method with an instance of <span class="cv_-_computer_voice">MessageFinder</span>. Save this instance of <span class="cv_-_computer_voice">MessageFinder</span> in a private variable within your plugin instance.</div>
      <div class="B_-_Body"><a name="3110522">A plugin callback handler (</a><span class="cv_-_computer_voice">PluginCallbackHandler</span>) is an object provided to your message reply plugin. The callback handler safely executes the message reply callback code block. The callback handler sets up the callback’s server thread and the database transaction information so entity changes safely and consistently save to the database.</div>
      <div class="B_-_Body"><a name="4197438">If you want to get parameters from the plugin registry, your messaging plugin implementation must explicitly implement </a><span class="cv_-_computer_voice">InitializablePlugin</span> in its class declaration. The <span class="cv_-_computer_voice">InitializablePlugin</span> interface declares that the class supports the <span class="cv_-_computer_voice">setParameters</span> method to get parameters from the plugin registry. The application calls the plugin method <span class="cv_-_computer_voice">setParameters</span> and passes the parameters as name-value pairs of <span class="cv_-_computer_voice">String</span> values in a <span class="cv_-_computer_voice">java.util.Map</span> object.</div>
      <div class="B_-_Body"><a name="4069013">For important information about using message finders to submit errors and duplicates, see </a><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#4431574', '');" title="Implementing Messaging Plugins">“Error Handling in Messaging Plugins”</a>.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="4432637">BillingCenter includes multi-threaded inbound integration APIs that you can optionally use in conjunction with </a><span class="cv_-_computer_voice">MessageReply</span> plugins. For example, listen for JMS messages or process text files that represent message replies. If you want to use input data other than JMS messages or text files for message replies, write a custom integration by implementing the <span class="cv_-_computer_voice">InboundIntegrationMessageReply</span> plugin. <span class="cv_-_computer_voice">InboundIntegrationMessageReply</span> is a subinterface of <span class="cv_-_computer_voice">MessageReply</span>. See <a href="javascript:WWHClickedPopup('integration', 'inbound-integration.21.2.html#2211201', '');" title="Multi-threaded Inbound Integration Overview">“Multi-threaded Inbound Integration Overview”</a> and <a href="javascript:WWHClickedPopup('integration', 'inbound-integration.21.6.html#2293646', '');" title="Custom Inbound Integrations">“Custom Inbound Integrations”</a>.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3114855">Message Reply Plugin Initialization</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3114856">During initialization, the message reply plugin must get and store a reference to the message finder (</a><span class="cv_-_computer_voice">MessageFinder</span>) and callback handler (<span class="cv_-_computer_voice">PluginCallbackHandler</span>) objects, since it needs to use them later.</div>
      <div class="B_-_Body"><a name="3114861">Implement the simple </a><span class="cv_-_computer_voice">MessageReply</span> interface and include the <span class="cv_-_computer_voice">initTools</span> method, which gets these objects as parameters. Your plugin implementation must store these values in private properties, for example in private properties <span class="cv_-_computer_voice">_pluginCallbackHandler</span> and <span class="cv_-_computer_voice">_messageFinder</span>.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3114853">Message Reply Callbacks</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3110535">To acknowledge the message asynchronously, your message reply plugin uses its reference to the </a><span class="cv_-_computer_voice">PluginCallbackHandler</span>. To run your code, you plugin must pass a specially-prepared block of Java code to the <span class="cv_-_computer_voice">PluginCallbackHandler</span> method called <span class="cv_-_computer_voice">execute</span>. </div>
      <div class="B_-_Body"><a name="3762335">The </a><span class="cv_-_computer_voice">execute</span> method takes a <span class="e_-_emphasis">message reply callback block</span>, which is an instance of <span class="cv_-_computer_voice">PluginCallbackHandler.Block.</span> The <span class="cv_-_computer_voice">Block</span> is a simple private interface to encapsulate the block of code that you write.</div>
      <div class="B_-_Body"><a name="4431708">The </a><span class="cv_-_computer_voice">PluginCallbackHandler</span> object has an <span class="cv_-_computer_voice">add</span> method that marks a BillingCenter entity as modified so the application commits changes to the database with the message acknowledgement. Call the <span class="cv_-_computer_voice">add</span> method and pass an entity instance. This method adds the entity to the correct <span class="e_-_emphasis">bundle</span>. For more about bundles, see <a href="javascript:WWHClickedPopup('gosu', 'transactions.22.01.html#1456387', '');" title="Bundles and Database Transactions">“Bundles and Database Transactions” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.22.01.html#1456387', '');" title="Bundles and Database Transactions">Gosu Reference Guide</a></span>. This process ensures that changes to the entity instance commit to the database in the correct database transaction with related changes. </div>
      <div class="B_-_Body"><a name="3110547">Your code in </a><span class="cv_-_computer_voice">PluginCallbackHandler.Block</span> must perform the following steps:</div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="3110550">Find a </a><span class="cv_-_computer_voice">Message</span> object. Use methods on the plugin’s <span class="cv_-_computer_voice">MessageFinder</span> instance, described earlier in this section.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3110554">Call methods on the </a><span class="cv_-_computer_voice">Message</span> to signal acknowledgement or errors:</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="4427194">To report success, call the </a><span class="cv_-_computer_voice">reportAck</span> method on the message. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="4427203">To report errors, call the </a><span class="cv_-_computer_voice">reportError</span> method on the message. There are multiple method signatures to accommodate automatic retries and error categories. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="4427283">To report duplicates, call the </a><span class="cv_-_computer_voice">reportDuplicate</span> method on the message history (<span class="cv_-_computer_voice">MessageHistory</span>) entity instance that corresponds to the original message.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LP_-_List_Para"><a name="4427287">For details, see </a><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.08.html#4263397', '');" title="Reporting Acknowledgements and Errors">“Submitting Acks, Errors, and Duplicates from Messaging Plugins”</a>.</div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="4308888">Optional post-processing such as property updates or triggering custom events. If any objects must be modified other than the objects originally attached to the message, the callback block must call </a><span class="cv_-_computer_voice">PluginCallbackHandler.add(</span><span class="ps_-_parameter_in_code_snippets">entityReference</span><span class="cv_-_computer_voice">)</span>. This call to the <span class="cv_-_computer_voice">add</span> method ensures all changes on the other objects properly commit to the database as part of that database transaction. You must use the return result of the <span class="cv_-_computer_voice">add</span> method and only modify that return result. The return result is a clone of the object that is now writable. Do not continue to hold a reference to the original object you passed to the <span class="cv_-_computer_voice">add</span> method. This is equivalent to the <span class="cv_-_computer_voice">bundle.add(</span><span class="ps_-_parameter_in_code_snippets">entityReference</span><span class="cv_-_computer_voice">)</span> method, which adds an entity instance to a writable bundle. For more information, see <a href="javascript:WWHClickedPopup('gosu', 'transactions.22.04.html#1611659', '');" title="Adding Entity Instances to Bundles">“Adding Entity Instances to Bundles” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.22.04.html#1611659', '');" title="Adding Entity Instances to Bundles">Gosu Reference Guide</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3114850">For example, the following example demonstrates creating a </a><span class="cv_-_computer_voice">PluginCallbackHandler.Block</span> object and executing the callback block. </div>
      <PRE class="CF_-_Code_First_Line"><a name="3110564">...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110565">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110566">PluginCallbackHandler.Block block = new PluginCallbackHandler.Block() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110567">        public void run() throws Throwable {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110568">          Message message = _messageFinder.findById(messageID);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110569">          message.reportAck();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110570">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110571">      };</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110572"> &nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110573">_pluginCallbackHandler.execute(block);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110574">&nbsp;</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="3110575">...</a></PRE>
      <div class="B_-_Body"><a name="3715976">You can call </a><span class="cv_-_computer_voice">EntityFactory</span> as necessary in your callback handler block to create or find entities. The application properly sets up the thread context so that it supports <span class="cv_-_computer_voice">EntityFactory</span>. For more information about <span class="cv_-_computer_voice">EntityFactory</span>, see <a href="javascript:WWHClickedPopup('integration', 'java-api.33.03.html#2126983', '');" title="Accessing Entity and Typecode Data in Java">“Accessing Entity and Typecode Data in Java”</a>.</div>
      <div class="B_-_Body"><a name="3110621">For details of exceptions and handling suspend/shutdown in messaging plugins, see </a><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#4431574', '');" title="Implementing Messaging Plugins">“Error Handling in Messaging Plugins”</a>.</div>
      <h4 class="H2_-_Heading_2"><a name="4431574">Error Handling in Messaging Plugins</a></h4>
      <div class="B_-_Body"><a name="3138749">For a summary of message error APIs, see </a><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.08.html#4016335', '');" title="Reporting Acknowledgements and Errors">“Reporting Acknowledgements and Errors”</a>.</div>
      <div class="B_-_Body"><a name="4278572">Several methods on messaging plugins execute in a strict order for a message. Consult the following list to design your messaging code, particularly error-handling code: </a></div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="3138750">BillingCenter selects a message from the send queue on the batch server.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3752124">If this destination defines a </a><span class="cv_-_computer_voice">MessageRequest</span> plugin, BillingCenter calls <span class="cv_-_computer_voice">MessageRequest.beforeSend</span>. This method uses the text payload in <span class="cv_-_computer_voice">Message.payload</span> and transforms it and returns the transformed payload. The message transport method uses this transformed message payload later.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3138629">If </a><span class="cv_-_computer_voice">MessageRequest.beforeSend</span> made changes to the <span class="cv_-_computer_voice">Message</span> entity or other entities, BillingCenter commits those changes to the database, assuming that method threw no exceptions. The following special rules apply:</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="3138630">Committing entity changes is important if your integration code must choose among multiple pooled outgoing messaging queues. If errors occur, to avoid duplicates the message must always resend to the same queue each time. If you require this approach, add a data model extension property to the </a><span class="cv_-_computer_voice">Message</span> entity to store the queue name. In <span class="cv_-_computer_voice">beforeSend</span> method, choose a queue and set your extension property to the queue name. Then, your main messaging plugin (<span class="cv_-_computer_voice">MessageTransport</span>) uses this property to send the message to the correct queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="3138631">If exceptions occur, the application rolls back changes to the database and sets the message to retry later. There is no special exception type that sets the message to&nbsp;retry (an un-retryable error). </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="3249520">In all cases, the application never explicitly commits the transformed payload to the database.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3758922">BillingCenter calls </a><span class="cv_-_computer_voice">MessageTransport.send(</span><span class="ps_-_parameter_in_code_snippets">message</span><span class="cv_-_computer_voice">, </span><span class="ps_-_parameter_in_code_snippets">transformedPayload</span><span class="cv_-_computer_voice">)</span>. The <span class="cv_-_computer_voice">Message</span> entity can be changed, but the transformed payload parameter is read-only and effectively ephemeral. If you throw exceptions from this method, BillingCenter triggers automatic retries potentially multiple times. This is the only way to get the automatic retries including the backoff multiplier and maximum retries detection.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3758927">If this destination defines a </a><span class="cv_-_computer_voice">MessageRequest</span> plugin, BillingCenter calls <span class="cv_-_computer_voice">MessageRequest.afterSend</span>. This method can change the <span class="cv_-_computer_voice">Message</span> if desired.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3138643">Any changes from </a><span class="cv_-_computer_voice">send</span> and <span class="cv_-_computer_voice">afterSend</span> methods (<a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#3758922', '');" title="Implementing Messaging Plugins">step 4</a> and <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.10.html#3758927', '');" title="Implementing Messaging Plugins">step 5</a>) commit if and only if no exceptions occurred yet. Any exceptions roll back changes to the database and set the message to retry. Be aware there is no special exception class that sets the message not&nbsp;to&nbsp;retry.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3138644">If this destination defines a </a><span class="cv_-_computer_voice">MessageReply</span> plugin, its callback handler code executes separately to handle asynchronous replies. Any changes to the <span class="cv_-_computer_voice">Message</span> entity or other entities commit to the database after the code completes, assuming the callback throws no exceptions.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3138721">If there are problems with a message, you do not necessarily need to throw an exception in all cases. For example, depending on the business logic of the application, it might be appropriate to </a><span class="e_-_emphasis">skip</span> the message and notify an administrator. If you need to resume a destination later, you can do that using the web services APIs.</div>
      <div class="B_-_Body"><a name="3247252">All Gosu exceptions or Java exceptions during the methods </a><span class="cv_-_computer_voice">send</span>, <span class="cv_-_computer_voice">beforeSend,</span> or <span class="cv_-_computer_voice">afterSend</span> methods imply retryable errors. However, the distinction between retryable errors and non-retryable errors still exists if submitting errors later in the message’s life cycle. For example, you can mark non-retryable errors while acknowledging messages with web services or in asynchronous replies implemented with the <span class="cv_-_computer_voice">MessageReply</span> plugin.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3180071">Submitting Errors</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3715964">If there is an error for the message, call the </a><span class="cv_-_computer_voice">reportError</span> method on the message. There is an optional method signature to support automatic retries. See <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.08.html#4263397', '');" title="Reporting Acknowledgements and Errors">“Submitting Acks, Errors, and Duplicates from Messaging Plugins”</a>.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3715971">Handling Duplicates</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3710306">Your code must handle the possibility of receiving duplicate messages at the plugin layer or at the external system. Typically the receiving system detects duplicate messages by tracking the message ID and returns an appropriate status message. The plugin code that receives the reply messages can report the duplicate with </a><span class="cv_-_computer_voice">message.reportDuplicate()</span> and skip further processing. </div>
      <div class="B_-_Body"><a name="4087484">Depending on the implementation, your code that receives the reply messages is either within the </a><span class="cv_-_computer_voice">MessageTransport.send() method </span>or in your <span class="cv_-_computer_voice">MessageReply</span> plugin. For more information about acknowledgements and errors, see <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.23.08.html#4263397', '');" title="Reporting Acknowledgements and Errors">“Submitting Acks, Errors, and Duplicates from Messaging Plugins”</a>.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3760521">Saving the Destination ID for Logging or Errors</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3760522">Each messaging plugin implementation must have a </a><span class="cv_-_computer_voice">setDestinationID</span> method, which allows the plugin to find out its own destination ID and store it in a private variable. The destination can use the destination ID within code such as:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3752343">Logging code to record the destination ID.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3752344">Exception-handling code that works differently for each destination.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3752351">Other integrations, such as sending destination ID to external systems so that they can suspend/resume the destination if necessary.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <h4 class="H2_-_Heading_2"><a name="3110658">Handling Messaging Destination Suspend, Resume, Shutdown</a></h4>
      <div class="B_-_Body"><a name="3623282">The standard messaging plugins have methods that perform special actions for the administrative commands for destination suspend, destination resume, and before messaging system shutdown.</a></div>
      <div class="B_-_Body"><a name="3710358">Typically, suspend and resume is the result of an administrator using the BillingCenter </a><span class="ui_-_UI_element">Administration</span> tab in the user interface to suspend or resume a messaging destination. Alternatively, suspend and resume could be the result of a web service API call to suspend or resume destinations.</div>
      <div class="B_-_Body"><a name="3710359">Messaging shut down occurs during server shutdown or if the configuration is about to be reread. After message sending resumes again, BillingCenter reuses the same </a><span class="e_-_emphasis">instance</span> of the plugin. BillingCenter does not destroy the existing messaging plugin instance (or recreate it) as part of shutdown. </div>
      <div class="B_-_Body"><a name="3623314">To trap these actions, implement the </a><span class="cv_-_computer_voice">suspend</span>, <span class="cv_-_computer_voice">shutdown</span>, and <span class="cv_-_computer_voice">resume</span> methods of your messaging plugin.</div>
      <div class="B_-_Body"><a name="3110665">You can implement these methods just for logging and notification, if nothing else. For example, a message transport plugin’s </a><span class="cv_-_computer_voice">suspend</span> or <span class="cv_-_computer_voice">shutdown</span> methods could log the action and send notifications as appropriate. For example:</div>
      <PRE class="CF_-_Code_First_Line"><a name="3110666">public void suspend() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110667">&nbsp;&nbsp;...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110668">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110669">&nbsp;&nbsp;if(_logger.isDebugEnabled()) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110670">&nbsp;&nbsp;&nbsp;&nbsp;_logger.debug("Suspending message transport plugin.")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110671">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110672">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110673">&nbsp;&nbsp;MyEmailHelperClass.sendEmail(".....")</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="3110674">}</a></PRE>
      <div class="B_-_Body"><a name="3222194">During the </a><span class="cv_-_computer_voice">suspend</span>, <span class="cv_-_computer_voice">shutdown</span>, and <span class="cv_-_computer_voice">resume</span> methods of the plugin, the plugin must not call any BillingCenter <span class="cv_-_computer_voice">IMessageToolsAPI</span> web service APIs that suspend or resume messaging destinations. Doing so creates circular application logic, so such actions are forbidden.</div>
      <div class="B_-_Body"><a name="3222234">It is unsupported for a messaging plugin </a><span class="cv_-_computer_voice">suspend</span>, <span class="cv_-_computer_voice">shutdown</span>, and <span class="cv_-_computer_voice">resume</span> method to use messaging web service APIs that suspend or resume messaging destinations.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>